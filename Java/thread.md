# Thread

当多个线程访问某个类时，不管运行环境怎样调度，都不需要调用端做额外的同步，这个类都能表现出正确的行为。

Note

* 内置锁 synchronized  重入

* 对于可能被多个线程同时访问的可变状态变量，在访问它时都需要持有同一个锁，这种情况称为变量是被锁保护的。
* 添加涉及到共享和可变变量的新方法，也要使用同步，避免破坏加锁协议。
* 复合操作 同步代码块
* 单个操作 atomic class



线程封闭 --- 避免同步数据的方式

* 成员变量改为局部变量 栈封闭

* Thread local 当频繁执行的操作需要一个临时对象，例如一个缓冲区，事务上下文，而同时又希望避免在每次执行时都重新分配该临时对象

  线程终止后 thread local 被回收

* 当多个变量需要组成一定逻辑时，可以把他们聚合成一个不可变的新对象



ConccrentHashMap 分段锁，单机模式损失非常小，迭代器有弱一致性

注意size() 返回的结果在计算式可能已经过时了，近似值

Queue  --->  linkedList  ---> 取消随机访问，保证FIFO









